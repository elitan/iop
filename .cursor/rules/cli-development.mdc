---
description: 
globs: 
alwaysApply: false
---
# CLI Development Guidelines

## Command Structure

All CLI commands should follow the pattern established in [src/commands/](mdc:src/commands):

### Command Function Signature

```typescript
export async function commandName(args: string[], verbose: boolean = false) {
  // Command implementation
}
```

### Available Commands

- `init` - [src/commands/init.ts](mdc:src/commands/init.ts) - Initialize new Luma project
- `setup` - [src/commands/setup.ts](mdc:src/commands/setup.ts) - Setup target servers
- `deploy` - [src/commands/deploy.ts](mdc:src/commands/deploy.ts) - Deploy applications
- `status` - [src/commands/status.ts](mdc:src/commands/status.ts) - Check deployment status
- `redeploy` - [src/commands/redeploy.ts](mdc:src/commands/redeploy.ts) - Redeploy current version
- `rollback` - [src/commands/rollback.ts](mdc:src/commands/rollback.ts) - Rollback to previous version

## Flag Handling

Follow the pattern in [src/index.ts](mdc:src/index.ts):

```typescript
function parseArgs(args: string[]): { flags: string[]; nonFlagArgs: string[] } {
  // Parse --flags and regular arguments
}
```

### Standard Flags

- `--verbose` - Show detailed output
- `--force` - Force operation (deploy only)
- `--services` - Deploy services instead of apps (deploy only)

## Output Conventions

### Success Messages
```typescript
console.log("[✓] Operation completed successfully");
```

### Error Messages
```typescript
console.error("[✗] Operation failed: reason");
```

### Progress Indicators
```typescript
console.log("Starting operation...");
// ... operation
console.log("[✓] Operation completed (1.2s)");
```

## Blue-Green Deployment

The core deployment logic is in [src/commands/blue-green.ts](mdc:src/commands/blue-green.ts). This handles:

- Zero-downtime deployments
- Health checks
- Automatic rollbacks
- Traffic switching

## SSH Operations

SSH operations should use the ssh2-promise library pattern established in the codebase:

- Handle connection errors gracefully
- Use proper authentication methods
- Close connections properly
- Log SSH operations when verbose flag is enabled
